name: Deploy to Production

on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Allow manual trigger

jobs:
  deploy:
    name: ğŸš€ Deploy to Production Server
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
      
    - name: ğŸš€ Deploy via SSH
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USERNAME }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        port: ${{ secrets.SSH_PORT || 22 }}
        script: |
          echo "ğŸ”„ Starting deployment..."
          cd ${{ secrets.SERVER_PATH }}
          
          echo "ğŸ“¥ Pulling latest changes..."
          git pull origin main
          
          echo "ğŸ”’ Setting permissions..."
          chmod 755 -R .
          chmod 777 uploads/
          chmod 644 config.php
          
          echo "âœ… Deployment completed!"
          echo "ğŸŒ Site updated: $(date)"
          
    - name: ğŸ“¢ Deployment notification
      if: success()
      run: |
        echo "âœ… Deployment successful!"
        echo "ğŸ“… Deployed at: $(date)"
        echo "ğŸ“ Commit: ${{ github.sha }}"
        
    - name: âŒ Deployment failed notification
      if: failure()
      run: |
        echo "âŒ Deployment failed!"
        echo "Check the logs above for details"

